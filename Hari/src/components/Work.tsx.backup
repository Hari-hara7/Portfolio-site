import React, { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { useInView } from "react-intersection-observer";
import { FaGithub, FaExternalLinkAlt, FaEye } from "react-icons/fa";
import { Link } from "react-router-dom";
import ProjectModal from "./ProjectModal";

import project1Image from "../assets/we4tech.jpg";
import project2Image from "../assets/globallane.jpg";
import project3Image from "../assets/designgrid-BoOHbFyy.jpg";
import project4Image from "../assets/skillcrafters.jpg";
import project5Image from "../assets/academicpal.png";
import project6Image from "../assets/acm.jpg";
import project7Image from "../assets/aikyam1.png";
import crypto from "../assets/cryptotracker.png";
import annaraksha from "../assets/annaraksha.png";
import game from "../assets/gamestore.png";
import codecrash from "../assets/codecrash.png";
import mallannahair from "../assets/mallanna.png";
import campusleave from '../assets/leave.png';
import intership from '../assets/internship.png';

const Work: React.FC = () => {
  const [hoveredCard, setHoveredCard] = useState<number | null>(null);
  const [selectedProject, setSelectedProject] = useState<any>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);
  const [projects, setProjects] = useState([
    {
      title: "Crypto Tracker",
      description:
        "A real-time cryptocurrency tracking platform utilizing the CoinGecko API to provide live market data, price updates, and historical trends.",
      longDescription: "Crypto Tracker is a comprehensive cryptocurrency monitoring platform that provides real-time market data, price tracking, and portfolio management features. Built with modern web technologies and optimized for performance.",
      image: crypto, 
      github: "https://github.com/Hari-hara7/Crypto.git", 
      preview: "https://crypto-beta-five.vercel.app/",
      views: 750,
      technologies: ["React", "TypeScript", "Tailwind", "CoinGecko API"],
      features: [
        "Real-time cryptocurrency price tracking",
        "Interactive charts and graphs",
        "Portfolio management system",
        "Market trend analysis",
        "Responsive design for all devices"
      ],
      challenges: [
        "Handling real-time data updates efficiently",
        "Optimizing API calls to prevent rate limiting",
        "Creating smooth animations for price changes",
        "Implementing accurate portfolio calculations"
      ],
      completionDate: "2024-03-15",
      teamSize: 1,
      githubStats: {
        stars: 15,
        forks: 8,
        commits: 45
      }
    },
    {
      title: "Academic Pal",
      description:
        "A platform offering notes and resources for B.Tech students, organized by year and branch.",
      longDescription: "Academic Pal is an educational platform designed specifically for B.Tech students, providing organized study materials, notes, and resources categorized by year and branch.",
      image: project5Image,
      github: "https://github.com/Hari-hara7/Academicpal--login.git",
      preview: "https://academicpal.in/",
      views: 500,
      technologies: ["React", "Node.js", "MongoDB", "Firebase"],
      features: [
        "Organized study materials by branch and year",
        "User authentication and profile management",
        "File upload and download system",
        "Search and filter functionality",
        "Community-driven content sharing"
      ],
      challenges: [
        "Organizing large amounts of educational content",
        "Implementing secure file sharing system",
        "Creating intuitive navigation for students",
        "Managing user permissions and access levels"
      ],
      completionDate: "2023-11-20",
      teamSize: 2,
      githubStats: {
        stars: 25,
        forks: 12,
        commits: 78
      }
    },
    {
      title: "Anna Raksha",
      description:
        "A food donation and distribution platform connecting donors with NGOs and individuals in need, ensuring efficient food management and reducing waste.",
      longDescription: "Anna Raksha is a social impact platform that bridges the gap between food donors and those in need, featuring smart distribution algorithms and real-time tracking.",
      image: annaraksha, 
      github: "https://github.com/Hari-hara7/anna-raksha.git", 
      preview: "https://anna-raksha-bmu9.vercel.app/",
      views: 620,
      technologies: ["React", "Node.js", "MongoDB", "Express"],
      features: [
        "Donor and recipient registration system",
        "Real-time food availability tracking",
        "Location-based matching algorithm",
        "NGO verification and management",
        "Impact tracking and analytics"
      ],
      challenges: [
        "Implementing location-based matching efficiently",
        "Ensuring food safety and quality standards",
        "Creating scalable distribution algorithms",
        "Managing complex user role permissions"
      ],
      completionDate: "2024-06-10",
      teamSize: 3,
      githubStats: {
        stars: 32,
        forks: 18,
        commits: 156
      }
    },
    {
      title: "CodeCrash",
      description:
        "A fast-paced coding platform where users solve coding challenges within 2 minutes. Built with **Next.js 15+**, **Prisma**, **NenoDB via PostgreSQL**, and **Tailwind CSS**.",
      longDescription: "CodeCrash is a competitive programming platform that challenges developers to solve coding problems under time pressure, enhancing problem-solving skills and algorithmic thinking.",
      image: codecrash,
      github: "https://github.com/Hari-hara7/code-crash.git",
      preview: "https://code-crash-8tel.vercel.app/",
      views: 500,
      technologies: ["Next.js", "TypeScript", "Prisma", "PostgreSQL"],
      features: [
        "2-minute coding challenges",
        "Real-time leaderboard",
        "Problem difficulty levels",
        "Performance analytics",
        "User progress tracking"
      ],
      challenges: [
        "Implementing precise timer functionality",
        "Real-time leaderboard updates",
        "Code execution security",
        "Performance optimization for concurrent users"
      ],
      completionDate: "2024-05-20",
      teamSize: 1,
      githubStats: {
        stars: 18,
        forks: 7,
        commits: 67
      }
    }
    // Add more projects as needed...
  ]);
  const [selectedProject, setSelectedProject] = useState<any>(null);
  const [isModalOpen, setIsModalOpen] = useState(false);

  const updateViewCount = (title: string) => {
    const updatedProjects = projects.map((project) => {
      if (project.title === title) {
        return { ...project, views: project.views + 1 };
      }
      return project;
    });

    setProjects(updatedProjects);

    const updatedViews = updatedProjects.reduce((acc, project) => {
      acc[project.title] = project.views;
      return acc;
    }, {} as Record<string, number>);
    localStorage.setItem("projectViews", JSON.stringify(updatedViews));
  };

  return (
    <section id="work" className="bg-dark-900 text-white py-16 px-6 md:px-12">
      <div className="max-w-6xl mx-auto text-center">
        <motion.h2
          initial={{ opacity: 0, y: -50 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-4xl md:text-5xl font-bold text-gradient font-orbitron"
        >
          My Work
        </motion.h2>

        <motion.p
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.8, delay: 0.3 }}
          className="text-lg md:text-xl mt-4 text-gray-300 font-Quattrocento"
        >
          Here are some projects Iâ€™ve worked on recently.
        </motion.p>

        <div className="mt-12 grid gap-8 md:grid-cols-2 lg:grid-cols-3 font-Quattrocento">
          {projects.map((project, index) => (
            <ScrollCard
              key={index}
              project={project}
              onClick={() => updateViewCount(project.title)}
              isHovered={hoveredCard === index}
              onMouseEnter={() => setHoveredCard(index)}
              onMouseLeave={() => setHoveredCard(null)}
            />
          ))}
        </div>

        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.8, delay: 0.6 }}
          className="mt-12"
        >
          <Link
            to="/work"
            className="px-8 py-3 rounded-lg bg-gradient-to-r from-cyan-500 via-blue-500 to-green-500 hover:from-green-500 hover:to-cyan-500 text-white font-semibold text-lg shadow-lg transition-all duration-300"
          >
            More Projects
          </Link>
        </motion.div>
      </div>
    </section>
  );
};

const ScrollCard = ({
  project,
  onClick,
  isHovered,
  onMouseEnter,
  onMouseLeave,
}: {
  project: any;
  onClick: () => void;
  isHovered: boolean;
  onMouseEnter: () => void;
  onMouseLeave: () => void;
}) => {
  const { ref, inView } = useInView({
    threshold: 0.2, // Adjust this threshold as needed
    triggerOnce: true,
  });

  return (
    <motion.div
      ref={ref}
      onMouseEnter={onMouseEnter}
      onMouseLeave={onMouseLeave}
      initial={{ x: -100, opacity: 0 }}
      animate={inView ? { x: 0, opacity: 1 } : {}}
      transition={{ duration: 0.6, delay: 0.1 }}
      whileHover={{ scale: 1.05 }}
      onClick={onClick}
      className={`p-6 rounded-lg shadow-lg cursor-pointer ${
        isHovered ? "border-4 border-cyan-500 shadow-cyan-500" : "border border-gray-800"
      }`}
    >
      <img
        src={project.image}
        alt={project.title}
        className="w-full h-40 object-cover rounded-lg mb-4"
      />
      <h3 className="text-xl font-semibold text-gradient flex items-center justify-between font-orbitron">
        <span>{project.title}</span>
        <span className="flex items-center text-gray-400">
          <FaEye className="mr-1" />
          {project.views}
        </span>
      </h3>
      <p className="text-gray-400 mt-2">{project.description}</p>
      <div className="flex justify-between items-center mt-4">
        <a
          href={project.github}
          target="_blank"
          rel="noopener noreferrer"
          className="flex items-center gap-2 text-cyan-400 hover:underline"
        >
          <FaGithub /> GitHub
        </a>
        <a
          href={project.preview}
          target="_blank"
          rel="noopener noreferrer"
          className="flex items-center gap-2 text-cyan-400 hover:underline"
        >
          <FaExternalLinkAlt /> Preview
        </a>
      </div>
    </motion.div>
  );
};

export default Work;
